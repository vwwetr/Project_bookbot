# Краткий список технологий и сервисов White Node
```sh
- CentOS Stream #Серверная ОС корпоративного уровня
- SELinux #Мандатная безопасность, защита процессов
- firewalld #Основной firewall, политика запрета по умолчанию
- auditd #Аудит действий, запись системных событий
- chronyd #Синхронизация времени для TLS и логов
- Nginx #Reverse-proxy и обработка HTTPS
- ModSecurity #WAF-движок для защиты веб-трафика
- OWASP CRS #Готовые правила WAF против веб-атак
- Fail2ban #Автоблокировка брутфорсов и сканеров
- WireGuard #VPN-туннель для защищённого внутреннего трафика
- Docker #Контейнеризация и изоляция сервисов
- Docker Compose #Управление контейнерами и конфигурацией
- OpenJDK 17 #Java Runtime для Spring Boot
- Spring Boot Telegram Bot #Само приложение бота
- FluentD #Сбор логов и отправка в центральный хаб
- Zabbix Agent #Мониторинг ресурсов и состояния ноды
- HashiCorp Vault #Безопасное хранение секретов
```
---

# Белый IP. Полная Инструкция, Требования и Технологический Стек (WHITE NODE)

## 1. Назначение белой ноды

Публичный сервер (White Node) --- это изолированная DMZ-нода с белым IP,
предназначенная для: - Приёма Telegram Webhook. - Размещения Spring Boot
Telegram bot. - Безопасного взаимодействия с интернетом. - Минимального
взаимодействия с внутренними сервисами (только через строго разрешённые
порты). - Передачи логов в центральный FluentD-хаб (Нода №5). -
Мониторинга через Zabbix.

White Node --- единственная публичная точка входа.

------------------------------------------------------------------------

# 2. Минимальные системные требования

## 2.1. Аппаратные

-   **CPU:** 1--2 vCPU\
-   **RAM:** 1--2 GB\
-   **Disk:** 10--20 GB SSD\
-   **Network:** Статический белый IP

## 2.2. ОС

**Рекомендуемые:** - RockyLinux 8\
- CentOS Stream 9

**Допустимо:** - Ubuntu 22.04 LTS\
- CentOS 7 (не рекомендуется)

------------------------------------------------------------------------

# 3. Технологический стек White Node (полный)

## 3.1. Базовая ОС и сервисы

-   RockyLinux / CentOS Stream
-   SELinux: enforcing
-   firewalld / nftables
-   auditd (обязателен)
-   chronyd (точное время)

## 3.2. Сетевой уровень / Zero Trust

White Node должна находиться в отдельной DMZ-сети.

### Входящие разрешены:

  Порт                Назначение
  ------------------- ----------------------------
  443/tcp             Telegram Webhook
  80/tcp              redirect → 443
  22/tcp              только с IP администратора
  22/tcp (internal)   через VPN --- опционально

### Исходящие разрешены:

  Порт         Назначение
  ------------ ---------------------
  443/tcp      Telegram API
  53/tcp/udp   DNS
  24224/tcp    FluentD → Нода №5
  ❌           Остальное запрещено

------------------------------------------------------------------------

# 3.3. Reverse Proxy уровень

## Nginx

Используется как: - TLS terminator\
- ограничитель доступа (подсети Telegram)\
- rate limiter\
- WAF (при применении ModSecurity)

## TLS настройки:

-   TLS 1.2--1.3
-   Строгий набор шифров
-   HSTS
-   OCSP Stapling
-   Автоматическое обновление сертификатов (Let's Encrypt)

## Webhook защита:

Разрешены только подсети Telegram: - 91.108.4.0/22 - 91.108.8.0/22 -
149.154.160.0/20

------------------------------------------------------------------------

# 3.4. Приложение Telegram Bot

## Java Runtime

-   OpenJDK 17 LTS

## Docker (рекомендуется)

-   Docker Engine\
-   Docker Compose

Контейнер запускается с:

    --read-only
    --cap-drop=ALL
    --user 1001:1001
    --memory=512m
    --cpus=0.5
    --pids-limit=100
    --no-new-privileges

## Systemd (альтернатива, менее безопасная)

Не рекомендуется для продакшена DMZ.

------------------------------------------------------------------------

# 3.5. Логирование

## FluentD (td-agent)

White Node → FluentD Hub (Нода №5).

### Правила фильтрации:

Удалять: - password\
- authorization\
- cookies

Таким образом исключается утечка Telegram-чата и пользовательских
данных.

------------------------------------------------------------------------

# 3.6. Мониторинг

## Zabbix Agent

Разрешён только: - outbound → Zabbix Server - inbound запрещён

------------------------------------------------------------------------

# 3.7. VPN (опционально)

WireGuard: - вход с white node → Нода №3 (internal technical Nginx) -
позволяет выполнять внутренние запросы без проброса портов

------------------------------------------------------------------------

# 3.8. IDS / IPS (уровень 2)

Рекомендуемые: - Wazuh Agent\
или\
- OSSEC

Функции: - контроль изменений файлов - детект аномалий - контроль
процессов - расследование событий

------------------------------------------------------------------------

# 3.9. WAF (уровень 3 --- повышенная защита)

ModSecurity + OWASP CRS 3.3

Защищает от: - SQL Injection\
- XSS\
- RCE\
- Path Traversal\
- Сканеров и ботнетов

------------------------------------------------------------------------

# 3.10. Секреты и токены

Минимально: - .env вне контейнера - ansible-vault

Рекомендуемо: - HashiCorp Vault\
Telegram Bot Token --- хранится только в Vault.

------------------------------------------------------------------------

# 3.11. Аудит и анализ безопасности

Регулярно: - Lynis (OS audit) - Trivy (Docker images) - Nmap (self-scan)

Все результаты → FluentD → OpenSearch.

------------------------------------------------------------------------

# 4. Инфраструктурная интеграция White Node

## Белая нода взаимодействует только:

-   c Telegram серверами (входящие 443)
-   с Нодой №5 (FluentD → 24224)
-   с твоим IP (SSH)
-   с DNS / NTP
-   (опционально) VPN → Нода №3 для внутренних запросов

## Белая нода НЕ ДОЛЖНА:

-   видеть базу данных\
-   видеть мониторинг\
-   видеть внутренние nginx\
-   иметь прямой доступ в кластеры

------------------------------------------------------------------------

# 5. Схема сетевого взаимодействия

                             ┌─────────────────────┐
                             │ Telegram Servers     │
                             └─────────┬───────────┘
                                       │
                                 HTTPS 443
                                       │
                            ┌──────────▼──────────┐
                            │   WHITE NODE (IP)   │
                            │   Nginx + Docker    │
                            └───────┬─────────────┘
                                    │
                            Logs →  │ 24224/tcp
                                    ▼
                          ┌───────────────────┐
                          │   Нода №5 (FD)    │
                          └───────────────────┘

------------------------------------------------------------------------

# 6. Файловая структура White Node

    /etc/nginx/nginx.conf
    /etc/nginx/conf.d/bot.conf

    /etc/fluentd/fluent.conf

    /opt/bot/
    /opt/bot/docker-compose.yml
    /opt/bot/secrets/

    /var/log/nginx/
    /var/log/secure
    /var/log/audit/audit.log

------------------------------------------------------------------------

# 7. Резюме --- итоговая конфигурация White Node

## White Node содержит:

### ОС:

-   RockyLinux / CentOS Stream\
-   firewalld\
-   SELinux\
-   auditd\
-   chronyd

### Сеть:

-   DMZ
-   strict firewall
-   Telegram whitelist
-   optional VPN

### Reverse Proxy:

-   Nginx (TLS 1.2/1.3)
-   HSTS, OCSP
-   ModSecurity (опционально)

### Приложение:

-   Docker + OpenJDK17
-   read-only container
-   non-root user

### Логи:

-   FluentD (анонимизация)
-   Zabbix Agent

### Безопасность:

-   Fail2Ban
-   Wazuh/OSSEC
-   HashiCorp Vault (рекомендуется)
-   Lynis / Trivy / Nmap

White Node --- максимально защищённая внешняя точка входа, не влияющая
на безопасность ядра твоей архитектуры.
