https://docs.ansible.com/projects/ansible/latest/collections/community/postgresql/index.html

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
- –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω–Ω—ã–µ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö:
    - –ù–∞–∑–≤–∞–Ω–∏–µ: `title VARCHAR(255) NOT NULL UNIQUE`
        - üîò –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—â–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞:"
    - –ê–≤—Ç–æ—Ä: `author VARCHAR(50)`
        - üîò –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–í–≤–µ–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–§–∞–º–∏–ª–∏—è –ò.–û. –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ "–ë–µ–∑ –∞–≤—Ç–æ—Ä–∞":"
    - –†–∞–∑–¥–µ–ª `section VARCHAR(50) NOT NULL`
        - üîò –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–æ –æ—Ç–Ω–µ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å (IT, Health, Finance, Lifestyle, Network, Spiritual):"
        - IT
        - Health
        - Finance
        - Lifestyle
        - Network
        - Spiritual
    - –§–æ—Ä–º–∞—Ç `format VARCHAR(50) NOT NULL`
        - üîò –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–í–≤–µ–¥–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ä–µ—Å—É—Ä—Å–∞ (Book, Article, Video, Audio):"
        - Book
        - Article
        - Video
        - Audio
    - –í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è (–º–∏–Ω.) `studytime INTEGER NOT NILL`
        - üîò –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–í–≤–µ–¥–∏—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤–∞–º –≤—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ, –≤ –º–∏–Ω. (15, 30, 60, 90, 120):"
    - –°—Å—ã–ª–∫–∞ (–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏) `link TEXT`
        - üîò –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ—Å—É—Ä—Å –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ "–ù–µ—Ç URL":"
    - –ö–æ–ª–æ–Ω–∫–∞ "normalized_title"
        - –£–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º, –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–∏–∂–Ω–µ–º—Ü —Ä–µ–≥–∏—Å—Ç—Ä—É, —É–¥–∞–ª—è–µ—Ç –¥–∏–∞–∫—Ä–∏—Ç–∏–∫—É, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≤—ã—á–∏—Å–ª—è–µ–º—ã–π —Å—Ç–æ–ª–±–µ—Ü
        - –ü–æ –Ω–µ–º—É —Å—Ç–æ–∏—Ç UNIQUE, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥—É–±–ª–µ–π"
        - unaccent - stable, —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –∏ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è (–Ω–µ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π);
        - –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ PostgreSQL –ø—Ä—è–º–æ —Å–∫–∞–∑–∞–Ω–æ: –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è generated-–∫–æ–ª–æ–Ω–∫–∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ IMMUTABLE-—Ñ—É–Ω–∫—Ü–∏–∏.
        - –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
            - String normalized = normalizeTitle(title); // lower + trim + unaccent
### –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
- –†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
## –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- üîò –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É–∂–µ –∏–º–µ—é—â–µ–≥–æ—Å—è –≤ –ë–î –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –±–æ—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–≤–æ–¥–∏—Ç—å "–≠—Ç–æ—Ç —Ä–µ—Å—É—Ä—Å —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ!"
- üîò –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ä–µ—Å—É—Ä—Å–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑—É—á–µ–Ω–∏—è, –≤ —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å–≤–∏—è –ª—é–±—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤, –±–æ—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–≤–æ–¥–∏—Ç—å "–†–µ—Å—É—Å—Ä—Å–æ–≤ –ø–æ —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –µ—â–µ –Ω–µ—Ç –≤ –±–∞–∑–µ!"
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞, —Ñ–æ—Ä–º–∞—Ç–∞, –≤—Ä–µ–º–µ–Ω–∏, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–∏—Å–∞—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ "–Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç" –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã –Ω–∞ –≤—ã–±–æ—Ä –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞;
- üîò –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ –ø—Ä–∏ –µ–≥–æ –Ω–∞–ª–∏—á–∏–∏ –≤ –ë–î:
    -  ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –º–µ—Ç–æ–¥ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–º —Å–ª–æ–µ (Service Layer), —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Å—É—Ä—Å–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.
- üîò –í–æ–∑–º–æ–∂–Ω–æ, –≤–º–µ—Å—Ç–æ "–í–≤–µ–¥–∏—Ç–µ" –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å "–í—ã–±–µ—Ä–∏—Ç–µ" –∏ –¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±—Ä–∞—Ç—å —Å–∞–º–æ–º—É –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ç–µ–ª–µ–≥—Ä–∞–º.
- üîò –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–±–æ—Ç) –¥–æ–ª–∂–Ω–æ –ª–∏–±–æ:
    - –ª–æ–≤–∏—Ç—å –æ—à–∏–±–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –∏ –≥–æ–≤–æ—Ä–∏—Ç—å ¬´—Ç–∞–∫–∞—è –∫–Ω–∏–≥–∞ —É–∂–µ –µ—Å—Ç—å¬ª
    - –ª–∏–±–æ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π —Å–ø—Ä–æ—Å–∏—Ç—å –ë–î: ¬´–µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–Ω–∏–≥–∞?¬ª.
## –°—Ç–µ–∫
- pg_dump, pgrestore, custom dump mode
    - pg_dump  - —Ä—è–¥–æ–º —Å –±–∞–∑–æ–π, –Ω–∞ —Ç—É –∂–µ –Ω–æ–¥—É;
    - pg_restore - —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –Ω–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
- –î–µ–∫—Å—Ç–æ–ø –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π: **DBeaver**
## –†–æ–ª–∏ –∏ –∏—Ö –ø—Ä–∞–≤–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
- postgres (–†–æ–ª—å, –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –ë–î)
- postgres (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏—Å—Ç–µ–º—ã)
- bookbot_app_role
    - –ì—Ä—É–ø–ø–æ–≤–∞—è —Ä–æ–ª—å ‚Äú–±–æ–µ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è‚Äù, –∫–æ—Ç–æ—Ä–∞—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç, —á—Ç–æ –ª—é–±–æ–π –µ—ë —á–ª–µ–Ω –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π RW-–¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–±–æ—Ç–∞).
    - NOLOGIN, —Å–µ—Ä–≤–∏—Å–Ω–∞—è –≥—Ä—É–ø–ø–∞
    - –ü—Ä–∞–≤–∞: 
        - GRANT CONNECT, TEMP ON DATABASE bookbot_db TO bookbot_app_role;
            - CONNECT ‚Äî –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –ë–î bookbot_db;
            - TEMP ‚Äî –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ —ç—Ç–æ–π –ë–î.
        - GRANT USAGE, CREATE ON SCHEMA public TO bookbot_app_role;
            - USAGE ‚Äî –º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ —Å—Ö–µ–º—ã (—Ç–∞–±–ª–∏—Ü–∞–º–∏, —Ç–∏–ø–∞–º–∏ –∏ —Ç.–ø.);
            - CREATE ‚Äî –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ public (—Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ñ—É–Ω–∫—Ü–∏–∏).—ë
        - GRANT SELECT, INSERT, UPDATE, DELETE
            ON ALL TABLES IN SCHEMA public
            TO bookbot_app_role;
                - –ü–æ–ª–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π DML-–Ω–∞–±–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏,–±–µ–∑¬´–∂—ë—Å—Ç–∫–∏—Ö¬ª –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–ø–æ–¥–æ–±–∏–µ TRUNCATE –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü.
        - GRANT USAGE, SELECT, UPDATE
            ON ALL SEQUENCES IN SCHEMA public
            TO bookbot_app_role;
                - USAGE ‚Äî –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å nextval() / currval() (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ SERIAL/IDENTITY);
                - SELECT ‚Äî –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ;
                - UPDATE ‚Äî –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ setval().
        - –ù–∞ –Ω–µ—ë –∑–∞–≤—è–∑–∞–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ –ë–î/—Å—Ö–µ–º—É/—Ç–∞–±–ª–∏—Ü—ã;
        - –í –Ω–µ—ë —Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –≤—Å–µ RW-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    - –ß–µ–≥–æ —É —Ä–æ–ª–∏ –Ω–µ—Ç:
        - –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö –ø—Ä–∞–≤ (CREATEDB, CREATEROLE, SUPERUSER, REPLICATION);
        - –ü—Ä–∞–≤ –Ω–∞ –¥—Ä—É–≥–∏–µ –±–∞–∑—ã;
        - –ù–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö DDL-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–π —Ç–∏–ø–∞ ALTER DATABASE, ALTER SYSTEM –∏ —Ç.–ø. (–∞–¥–º–∏–Ω–∏—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Ç–µ—Ä–∞)
- app_user ‚Äî LOGIN, —Ä–∞–±–æ—á–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
    - —á–ª–µ–Ω bookbot_app_role;
    - —Ö–æ–¥–∏—Ç –∏–∑ Spring Boot.
    - –ü—Ä–∞–≤–∞:
        - –ú–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ bookbot_db;
        - –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –≤ public (—Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã –∏ —Ç.–ø.);
        - –ú–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–ª–Ω—ã–π DML –Ω–∞–¥ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ public;
        - –ú–æ–∂–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏.
- readonly_user ‚Äî LOGIN, read-only:
    - –ü–æ–ª—É—á–∞–µ—Ç CONNECT + SELECT –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π RO-–≥—Ä—É–ø–ø—ã, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å —Å—Ö–µ–º—É).
## –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –§–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ file (–∏–ª–∏ template) —Ä–æ–ª–∏ –ø–æ –ø—É—Ç–∏: Project_bookboot/Ansible/database/files/
## Ansible —Ä–æ–ª–∏ 
- pg_isntall
- db_create
- db_backup

```sh
ansible-galaxy init pg_install 
ansible-galaxy init db_create
ansible-galaxy init db_backup
ansible-galaxy collection install community.postgresql
```
### db_backup tree
roles/postgresql_backup/
  tasks/
    main.yml
    user.yml
    dirs.yml
    scripts.yml
    cron.yml
    storage.yml
## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è db_role
–†–æ–ª—å –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ —Ç–∞–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL (pgdg)
2. initdb
3. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ TLS —Ñ–∞–π–ª–æ–≤
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ postgresql.conf
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pg_hba.conf
6. (handlers) –†–µ—Å—Ç–∞—Ä—Ç PostgreSQL
7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ postgresql_ping
8. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π / –±–∞–∑
### –õ–æ–≥–∏–∫–∞ –ª—é–±–æ–≥–æ –º–æ–¥—É–ª—è —Å ensure:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ä–æ–ª—å app_user.
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—Ç—å.
- –ï—Å–ª–∏ –µ—Å—Ç—å, –Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è (—Ñ–ª–∞–≥–∏, –ø–∞—Ä–æ–ª—å –∏ —Ç.–ø.) ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å.
- –ï—Å–ª–∏ –≤—Å—ë —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å.
- –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω idempotent state: ‚Äú—Å–¥–µ–ª–∞–π —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–æ—Ç —Ç–∞–∫‚Äù, –∞ –Ω–µ ‚Äú–≤—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É CREATE ROLE ‚Ä¶‚Äù.
- –¢–æ –µ—Å—Ç—å –ø–æ —Å—É—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ ‚Äú—Å–æ–∑–¥–∞—Ç—å‚Äù, –∞ ‚Äú—É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–æ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å –Ω—É–∂–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏‚Äù.
- –ò–º—è —Ç–∞—Å–∫–∏ ‚Äî —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–º—ã–ª–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ.
    - –¢–∞—Å–∫ –Ω–µ —Ä–∞–∑–æ–≤—ã–π, –∞ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π ‚Äî –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∏ –Ω–∞ 1-–π, –∏ –Ω–∞ 100-–π –ø—Ä–æ–≥–æ–Ω.
    - –ü–æ—ç—Ç–æ–º—É ‚ÄúEnsure ‚Ä¶‚Äù —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω–µ–µ –¥–ª—è idempotent –∫–æ–¥–∞.
- –í –ø–ª–æ—Å–∫–æ—Å—Ç–∏ IaC:
    "–í IaC —è –Ω–µ –ø–∏—à—É —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–µ–π—Å—Ç–≤–∏–π, —è –æ–ø–∏—Å—ã–≤–∞—é —Ü–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
    –¢–∞—Å–∫–∞ Ensure X ‚Äî —ç—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è: ‚Äú–æ–±—ä–µ–∫—Ç X –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ‚Äù.
    –î–∞–ª—å—à–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –µ–≥–æ —Å–æ–∑–¥–∞—Ç—å, –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å.
    –ü–æ—ç—Ç–æ–º—É —Å–ª–æ–≤–æ ‚ÄúEnsure‚Äù –ª—É—á—à–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∏–¥–µ–æ–ª–æ–≥–∏—é IaC, —á–µ–º ‚ÄúCreate‚Äù, –∫–æ—Ç–æ—Ä–æ–µ –∑–≤—É—á–∏—Ç –∫–∞–∫ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è."
## DDL, DML, DCL, TCL
- GRANT <—Å–ø–∏—Å–æ–∫_–ø—Ä–∏–≤–∏–ª–µ–≥–∏–π> ON <—Ç–∏–ø_–æ–±—ä–µ–∫—Ç–∞> <–æ–±—ä–µ–∫—Ç(—ã)> TO <—Ä–æ–ª—å(–∏)> [WITH GRANT OPTION]; ### DCL (Data Control Language)
    - ALTER DEFAULT PRIVILEGES: ‚Äú–¥–ª—è –≤—Å–µ—Ö –¢–ê–ë–õ–ò–¶, –∫–æ—Ç–æ—Ä—ã–µ –≤ –±—É–¥—É—â–µ–º —Å–æ–∑–¥–∞—Å—Ç app_user –≤ —Å—Ö–µ–º–µ public, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–¥–µ–ª–∞–π GRANT —Ç–∞–∫–∏—Ö-—Ç–æ –ø—Ä–∞–≤ —Ç–∞–∫–∏–º-—Ç–æ —Ä–æ–ª—è–º‚Äù.
### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤ –≤ db_create
```sql
-- 1. –ü—Ä–∞–≤–∞ –Ω–∞ –£–†–û–í–ù–ï –ë–ê–ó–´ –î–ê–ù–ù–´–• ‚Äî ‚Äú–ø—É—Å–∫–∞–µ–º –ª–∏ –º—ã –≤–æ–æ–±—â–µ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–≥—Ä—É–ø–ø—É –≤ —ç—Ç—É –ë–î?‚Äù
-- –†–∞–∑—Ä–µ—à–∞–µ–º –≥—Ä—É–ø–ø–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –ë–î –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
GRANT CONNECT, TEMP ON DATABASE "{{ postgresql_db_name }}" TO "{{ app_group_role }}";

-- –†–∞–∑—Ä–µ—à–∞–µ–º readonly-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —ç—Ç–æ–π –ë–î
GRANT CONNECT ON DATABASE "{{ postgresql_db_name }}" TO "{{ readonly_user }}";

-- 2. –ü—Ä–∞–≤–∞ –Ω–∞ –£–†–û–í–ù–ï –°–•–ï–ú–´ public - ‚Äú–º–æ–∂–Ω–æ –ª–∏ –µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ —ç—Ç–æ–π —Å—Ö–µ–º–µ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–º –Ω–æ–≤—ã–µ?‚Äù
-- –ì—Ä—É–ø–ø–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
--  USAGE  - –º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ —Å—Ö–µ–º–µ (—Ç–∞–±–ª–∏—Ü–∞–º–∏, —Ç–∏–ø–∞–º–∏ –∏ —Ç.–ø.)
--  CREATE - –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã (—Ç–∞–±–ª–∏—Ü—ã, —Å–µ–∫–≤–µ–Ω—Å—ã –∏ —Ç.–ø.) –≤ —Å—Ö–µ–º–µ public
GRANT USAGE, CREATE ON SCHEMA public TO "{{ app_group_role }}";

-- Readonly-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
--  USAGE - –º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ —Å—Ö–µ–º–µ (—á–∏—Ç–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã), –Ω–æ –ù–ï–õ–¨–ó–Ø —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ
GRANT USAGE ON SCHEMA public TO "{{ readonly_user }}";

-- 3. –ü—Ä–∞–≤–∞ –Ω–∞ –£–†–û–í–ù–ï –¢–ê–ë–õ–ò–¶ (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö) –≤ —Å—Ö–µ–º–µ public ‚Äî ‚Äú—á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ–Ω –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ ID?‚Äù
-- –î–ª—è –≥—Ä—É–ø–ø—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: –ø–æ–ª–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π DML-–Ω–∞–±–æ—Ä –Ω–∞ –í–°–ï –¢–ê–ë–õ–ò–¶–´ –≤ public
--  SELECT - —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
--  INSERT - –≤—Å—Ç–∞–≤–ª—è—Ç—å —Å—Ç—Ä–æ–∫–∏
--  UPDATE - –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç—Ä–æ–∫–∏
--  DELETE - —É–¥–∞–ª—è—Ç—å —Å—Ç—Ä–æ–∫–∏
GRANT SELECT, INSERT, UPDATE, DELETE
  ON ALL TABLES IN SCHEMA public
  TO "{{ app_group_role }}";

-- –î–ª—è readonly-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –í–°–ï–• –¢–ê–ë–õ–ò–¶ –≤ public
GRANT SELECT
  ON ALL TABLES IN SCHEMA public
  TO "{{ readonly_user }}";

-- 4. –ü—Ä–∞–≤–∞ –Ω–∞ –£–†–û–í–ù–ï SEQUENCE (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã id) –≤ —Å—Ö–µ–º–µ public ‚Äî ‚Äú–∞ —á—Ç–æ –¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ he —Å–æ–∑–¥–∞—Å—Ç –≤ –±—É–¥—É—â–µ–º?‚Äù
-- –î–ª—è –≥—Ä—É–ø–ø—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
--  USAGE  - –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å nextval()/currval()/setval(), —Ç.–µ. –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è sequence
--  SELECT - —á–∏—Ç–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ sequence
--  UPDATE - –º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ sequence (—á–µ—Ä–µ–∑ setval), –Ω—É–∂–Ω–æ ORM/–º–∏–≥—Ä–∞—Ü–∏—è–º
GRANT USAGE, SELECT, UPDATE
  ON ALL SEQUENCES IN SCHEMA public
  TO "{{ app_group_role }}";

-- 5. DEFAULT PRIVILEGES (–ø—Ä–∞–≤–∞ –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ –¥–ª—è –±—É–¥—É—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤)
-- –í–ê–ñ–ù–û: —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–µ–π—Å—Ç–≤—É—é—Ç –¥–ª—è –ù–û–í–´–• —Ç–∞–±–ª–∏—Ü,
-- –∫–æ—Ç–æ—Ä—ã–µ –≤ –±—É–¥—É—â–µ–º —Å–æ–∑–¥–∞—Å—Ç –†–û–õ–¨ "{{ app_user }}" –≤ —Å—Ö–µ–º–µ public.

-- –ü—Ä–∞–≤–∏–ª–æ ‚Ññ1:
--  –í—Å—ë, —á—Ç–æ —Å–æ–∑–¥–∞—Å—Ç app_user, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç RW-–ø—Ä–∞–≤–∞ –¥–ª—è –≥—Ä—É–ø–ø—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
ALTER DEFAULT PRIVILEGES FOR ROLE "{{ app_user }}"
  IN SCHEMA public
  GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO "{{ app_group_role }}";
-- –ü—Ä–∞–≤–∏–ª–æ ‚Ññ2:
--  –í—Å—ë, —á—Ç–æ —Å–æ–∑–¥–∞—Å—Ç app_user, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ readonly-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
ALTER DEFAULT PRIVILEGES FOR ROLE "{{ app_user }}"
  IN SCHEMA public
  GRANT SELECT ON TABLES TO "{{ readonly_user }}";

```
## –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
–í –ª–æ–≥–∏–∫–µ –±–æ—Ç–∞ / Spring Boot:
    - –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –∫–Ω–∏–≥–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å –ø–æ–ª–µ title –∫–∞–∫ –µ—Å—Ç—å;
    - –ë–î –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç: ¬´–¥–≤–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–æ–º, –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏ –¥–∏–∞–∫—Ä–∏—Ç–∏–∫–æ–π, –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ –º–æ–≥—É—Ç¬ª.
    - –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ ¬´–µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è –∫–Ω–∏–≥–∞¬ª, –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Ç–æ –∂–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ:
```sql
SELECT *
FROM books
WHERE lower(trim(unaccent(title))) = lower(trim(unaccent(:title_in)));
```
    - –µ—Å–ª–∏ –ø–æ–ø—ã—Ç–∞–µ—à—å—Å—è –≤—Å—Ç–∞–≤–∏—Ç—å ¬´–ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥—É–±–ª—å¬ª ‚Äî –ø–æ–π–º–∞–µ—à—å unique constraint violation –ø–æ –∏–Ω–¥–µ–∫—Å—É books_normalized_title_unique
## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∫–∞–ø–∞
- pg_dump (custom, –≤—ã–±—Ä–∞–Ω –ø–æ best practise –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π)
    - pg_dump –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–∞ Node4 (backup/monitoring-–Ω–æ–¥–∞) –ø–æ–¥ —Å–µ—Ä–≤–∏—Å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º pgbackup, –ø–æ–¥–∫–ª—é—á–∞—è—Å—å –∫ Node1 –ø–æ TCP.
- pg_restore 
    - –ò–∑ database –Ω–æ–¥—ã
- –î–∞–º–ø –ø–æ–≤–µ—Å–∏—Ç—å –Ω–∞ –∫—Ä–æ–Ω—Ç–∞–± 
    - –ù–∞ –∫–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ª–∏–Ω—É–∫—Å, –≤ –∫–∞–∫—É—é —Ä–æ–ª—å –ø–æ—Å—Ç–≥—Ä–µ—Å, —Å –∫–∞–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –≤ –∫–∞–∫—É—é –ë–î?
- –ö—É–¥–∞ –∫–∏–¥–∞–µ–º –¥–∞–º–ø –∏ –æ—Ç–∫—É–¥–∞ —Å—Ç–∞—Ä—Ç—É–µ–º pg_restore?
    - –ü–æ–∫–∞ –∏–¥–µ—è –∫–∏–¥–∞—Ç—å –¥–∞–º–ø –Ω–∞ –≤—Å–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–æ–¥—ã, –∫—Ä–æ–º–µ database, –≥–¥–µ –±–∞–∑–∞ –∫—Ä—É—Ç–∏—Ç—Å—è
    - Node1: —Ç–æ–ª—å–∫–æ Postgres, –±–µ–∑ –¥–æ–ª–≥–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ (–º–∞–∫—Å–∏–º—É–º ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–ø–∏—è –Ω–∞ –ø–∞—Ä—É –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤).
        - –î–∞–Ω–Ω—ã–µ —á–∏—Ç–∞–µ–º –≤—Å–µ–≥–¥–∞ —Å primary (Node1) ‚Äî –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–µ—Ç.
    - Node4: –æ—Å–Ω–æ–≤–Ω–æ–π backup-—Ö–æ—Å—Ç (—Ç–∞–º –∂–µ Pg-–∫–ª–∏–µ–Ω—Ç, —Å–∫—Ä–∏–ø—Ç—ã, cron, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞ —á–µ—Ä–µ–∑ Zabbix).
    - –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ ‚Äî Node4, —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏/–≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞ —á–µ—Ä–µ–∑ Zabbix.
    - Node5: –∑–∞–ø–∞—Å–Ω–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–≤–Ω—É—Ç—Ä–∏–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞—è –∫–æ–ø–∏—è –Ω–∞ localhost).
    - –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –∫–æ–ø–∏—è –±—ç–∫–∞–ø–æ–≤ —Å Node4 –Ω–∞ Node5.
    - –í–Ω–µ—à–Ω–µ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç –±—ç–∫–∞–ø–æ–≤ (—Å Node4 –∏–ª–∏ Node5) –Ω–∞ —Ö–æ—Å—Ç–æ–≤—ã–π Mac / –≤–Ω–µ—à–Ω–∏–π –¥–∏—Å–∫. Mac host / –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: off-site —É—Ä–æ–≤–µ–Ω—å.
### –õ–æ–≥–∏–∫–∞ –¥–∞–º–ø–∞:
- `pg_dump` –±—É–¥–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç–æ–º –Ω–∞ –º–∞—Å—Ç–µ—Ä-–Ω–æ–¥–µ, —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∞–º–ø –Ω–∞ –º–∞—Å—Ç–µ—Ä –Ω–æ–¥–µ, –ø–æ —Å–∫—Ä–∏–ø—Ç—É —á–µ—Ä–µ–∑ `cron` –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ –±–µ–∫–∞–ø-–Ω–æ–¥—É –∏ –≤ –∫–æ–Ω—Ü–µ —É–¥–∞–ª—è—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∞–º–ø —Å –º–∞—Å—Ç–µ—Ä–∞;
## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ linux –∏ crontab job
- user: pgbackup
- node4 (–æ—Å–Ω–æ–≤–Ω–∞—è backup-–Ω–æ–¥–∞):
    - `install -d -o pgbackup -g pgbackup -m 700 /var/lib/pgbackup` - –î–æ–º–∞—à–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - `install -d -o pgbackup -g pgbackup -m 750 /opt/pgbackup` - –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤
    - `install -d -o pgbackup -g pgbackup -m 750 /var/backups/postgresql` - –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –±–µ–∫–∞–ø–æ–≤
    - `install -d -o pgbackup -g pgbackup -m 750 /var/backups/postgresql/bookbot_db` - –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –±–µ–∫–∞–ø–æ–≤ (–∑–∞—á–µ–º?)
    - –ü—Ä–∞–≤–∞:
        - –∫–∞—Ç–∞–ª–æ–≥–∏: 750 (rwxr-x---), –≤–ª–∞–¥–µ–ª–µ—Ü pgbackup:pgbackup;
        - —Ñ–∞–π–ª—ã-–¥–∞–º–ø—ã: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 640 (rw-r-----), –≤–ª–∞–¥–µ–ª–µ—Ü pgbackup:pgbackup.
    - –ö–∞—Ç–∞–ª–æ–≥ –¥–ª—è—á –ª–æ–≥–æ–≤ –±–µ–∫–∞–ø-—Å–∫—Ä–∏–ø—Ç–æ–≤:
        - `install -d -o pgbackup -g pgbackup -m 750 /var/log/pgbackup`
        - –õ–æ–≥–∏ –≤–∏–¥–∞ /var/log/pgbackup/pgdump-bookbot_db.log —Å –ø—Ä–∞–≤–∞–º–∏ 640.
    - SSH –∏ .pgpass
    ```shell
    install -d -o pgbackup -g pgbackup -m 700 /var/lib/pgbackup/.ssh
    touch /var/lib/pgbackup/.pgpass
    chown pgbackup:pgbackup /var/lib/pgbackup/.pgpass
    chmod 600 /var/lib/pgbackup/.pgpass
    ```
 - pgbackup –Ω–µ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ PostgreSQL (/var/lib/pgsql/data –∏–ª–∏ —á—Ç–æ —Ç–∞–º —É —Ç–≤–æ–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).
- –ü—Ä–∞–≤–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ —Ü–µ–ª–æ–º:
    - –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è pgbackup –ø–æ best practice:
        - –ù–µ—Ç sudo, –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤.
    - –ù–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –æ–Ω –≤–ª–∞–¥–µ–µ—Ç —Ç–æ–ª—å–∫–æ:
        - —Å–≤–æ–∏–º home (/var/lib/pgbackup);
        - –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏ backup/logs/scripts, –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–º–∏ –≤—ã—à–µ.
    - –î–æ—Å—Ç—É–ø –∫ –ë–î —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ DB-—É—á—ë—Ç–∫—É backup_user (–≤ .pgpass), —Ä–æ–ª—å bookbot_backup_role –≤ PostgreSQL.
    - SSH-–∫–ª—é—á–∏:
        - Node4 ‚Üí Node5: –∫–ª—é—á –ª–µ–∂–∏—Ç –Ω–∞ Node4, authorized_keys –Ω–∞ Node5;
        - –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–ª—é—á –Ω–∞ Node5 from= –∏/–∏–ª–∏ command= –≤ authorized_keys, —á—Ç–æ–±—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è.
- –†–∞–∑–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–æ–ª–∏ –ø–æ –Ω–æ–¥–∞–º –≤ playbook
- –î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞—Å–∫—É —Ä–æ–ª–∏ db_create:
    - –°–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—É—é –≥—Ä—É–ø–ø–æ–≤—É—é —Ä–æ–ª—å –±–µ–∑ –ª–æ–≥–∏–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:
        - `CREATE ROLE bookbot_backup_role NOLOGIN;` –≠—Ç–∞ —Ä–æ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –Ω—É–∂–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞.

## –®–∞–≥–∏ –ø–æ db_backup role
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    - –ü—Ä–∏—Å—É—Ç—Å–≤—Ç–≤–∏–µ –Ω–∞ –Ω–æ–¥–∞—Ö (–ù–æ–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
    - –ü—Ä–∞–≤–∞
    - –†–æ–ª—å –≤ –±–∞–∑–µ
2. –û—Ç–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–ª—å —Å –ø–æ–ª—å–∑–∞–∫–∞–º–∏
3. –û—Ç–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–ª—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
4. –ù–∞–ø–∏—Å–∞—Ç—å —Ä–æ–ª—å —Å –±–µ–∫–∞–ø–æ–º
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
6. Zabbix, fluentd, Fluentbit?
7. –ó–∞–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø –≤ –±–∞–∑—É (–∫—Ä–æ–º–µ localhost –∏ log-node)